!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 221 $
!> $Author: dsu $
!> $Date: 2014-08-05 14:29:49 -0700 (Tue, 05 Aug 2014) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/relpfsat.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c real*8 function relpfsat
!c ------------------------
!c
!c compute relative permeability from saturation
!c  
!c compute the relative permeability using linear interpolation
!c at high saturations and a value of zero at very low saturations, 
!c otherwise use van Genuchten relationship
!c
!c taken from Joel VanderKwaak's Water Transport Simulator (WTS)
!c Version 1.0, March, 1996 
!c 
!c eps_conv is hardwired - should pass value through
!c
!c written by:      Kerry MacQuarrie - Nov. 1995
!c
!c last modified:   Uli Mayer - November 25, 96
!c                  Uli Mayer - February 13, 01
!c                  changed value for eps_conv:
!c                  Note setting k_rw to 0 seems not a wise 
!c                  thing to do
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           swc                = water saturation                    + -
!c           swr                = residual water saturation           + -
!c           expn               = krw - p equation exponent           + -
!c           gamma              = power index                         + -
!c           relpfsat           = relative permeability               * +
!c
!c common:   -  
!c
!c local:    real*8:
!c           -------
!c           se                 = effective saturation
!c           term1              = intermediate value
!c           v_gamma            = intermediate value
!c           sat_1              = intermediate value
!c           rkw_1              = intermediate value
!c           dk_ds              = intermediate value
!c           r1                 = constant
!c           r0                 = constant
!c           eps_conv           = constant
!c           aconstant          = constant
!c
!c external: -
!c ----------------------------------------------------------------------
 
      real*8 function relpfsat(swc,swr,expn,gamma)

      implicit none
      
      real*8 :: swc, swr, expn, gamma

      real*8 :: r0, r1, eps_conv, aconstant
      parameter (r0 = 0.0d0, r1 = 1.0d0, eps_conv = 1.0d-6,           &
     &           aconstant = r1 - eps_conv)
      
      real*8 :: se, v_gamma, sat_1, term1, rkw_1, dk_ds

!c  compute effective saturation

      se = (swc - swr)/(r1 - swr)

!c  compute some constants

      v_gamma = r1/gamma

!c  close to saturation -> use linear interpolation

      if (se.gt.aconstant) then

         sat_1 = aconstant
         term1 = (r1-sat_1**(v_gamma))**gamma
         rkw_1 = dsqrt(sat_1)*(r1-term1)*(r1-term1)

!c  note that the k_rw at sat=1.0 is 1.0

         dk_ds  = (r1-rkw_1)/(r1-sat_1)
         relpfsat = dk_ds*(se-sat_1)+rkw_1

!c  close to residual saturation -> set to zero

      elseif (se.lt.eps_conv) then

         relpfsat = r0
         

!c  intermediate saturations -> use van Genuchten directly

      else

         term1 = (r1-se**(v_gamma))**gamma
         relpfsat = se**expn*(r1-term1)*(r1-term1)  !for l = variable
!cff      relpfsat = dsqrt(se)*(r1-term1)*(r1-term1) !for l = 0.5d0

      end if

      return
      end

