!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 268 $
!> $Author: dsu $
!> $Date: 2015-01-09 17:00:41 -0800 (Fri, 09 Jan 2015) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/gas_advection/gasd_m.F90 $
!---------------------------------------------------------------------
!********************************************************************!
!c ----------------------------------------------------------------------
!c real*8 function gasd_m
!c ----------------------
!c
!c compute gas density from molar density and mol fractions
!c
!c input units for molar density are in [moles/l air]
!c ouptut density is in [Kg/m^3 air] = [g/l air]
!c
!c written by: Sergi Molins, May 2, 2006 
!c
!c last modified:
!c
!c modified by: Danyang Su - March 26, 2014
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           moldens            = molar density                       + - 
!c                                in control volume i
!c           molfrac(ng)        = gas mol fraction                    + -
!c           gasd_m             = gas pressure in control vol i       * +
!c
!c common:   
!c gen.f:    real*8:
!c           -------
!c           ng                 = number of gases                     + - 
!c           
!c chem.f:   real*8:
!c           -------
!c           gfwg(ng)           = gram formula weight (gases)         + -
!c
!c phys.f:   logical:
!c           --------
!c           update_dens_g      = .true. --> update density           + -
!c
!c local:    real*8:
!c           -------
!c           r0                 = constant
!c           r10_3              = constant
!c           dummy              = variable
!c           
!c           integer*4:
!c           ----------
!c           i                  = index
!c
!c external: -  
!c ----------------------------------------------------------------------
 
      real*8 function gasd_m(moldens,molfrac)

      use chem, only : ng, gfwg
      use phys, only : update_dens_g, dens_gcnst
 
      implicit none

!c  passed
      real*8, intent(in) :: moldens
      real*8, intent(in) :: molfrac(ng)
    
!c  internal
      integer :: i
      real*8 dummy, r0, r10_3   
      
!c  constants
      parameter (r0 = 0.0d0, r10_3 = 1.0d3)

      if (update_dens_g) then ! update density

!c  initialize
        dummy = r0

!c  calculate molar density
        do i = 1,ng
            dummy = dummy + molfrac(i) * gfwg(i)
        enddo

        dummy = moldens * dummy

      else ! constant density

        dummy = dens_gcnst
      
      endif 

!c  calculate density
      gasd_m = dummy
 
      return
      end