!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 221 $
!> $Author: dsu $
!> $Date: 2014-08-05 14:29:49 -0700 (Tue, 05 Aug 2014) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/secspec.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine secspec
!c ------------------
!c compute concentration of secondary species based on concentrations 
!c of primary species according to the law of mass action 
!c
!c written by:      Uli Mayer - October 10, 95
!c
!c last modified:   Uli Mayer - April 10, 96
!c                  sparse format for stoichiometric coefficients
!c                  Uli Mayer - November 15, 96
!c                  
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           c(nc)              = concentrations of primary species   + -
!c           c2                 = concentration of secondary species  * +
!c           eq2                = equilibrium constant for formation  + -
!c                                of secondary species from primary 
!c                                species
!c           gammac1(*)         = activity coefficients for primary   + -
!c                                species
!c           gammac2            = activity coefficients for           + -
!c                                secondary species
!c           xnuc(*)            = stoichiometric coefficient of       + -
!c                                primary species in secondary 
!c                                species
!c
!c           integer*4:
!c           ----------
!c           ia(*)              = row pointer array to                + -
!c                                stoichiometric coefficients of
!c                                primary species in secondary 
!c                                species
!c           i2                 = pointer to secondary species        + -
!c           ja(*)              = column pointer array to             + -
!c                                stoichiometric coefficients of 
!c                                primary species in secondary 
!c                                species 
!c           n                  = number of primary species           + -
!c
!c
!c local:    integer*4:
!c           ----------
!c           ic               = counter (free species)
!c           istart           = pointer (stoichiometric coefficients)
!c           iend             = pointer (stoichiometric coefficients)
!c           i                = counter (stoichiometric coefficients)
!c
!c external: -  
!c ----------------------------------------------------------------------
  
      subroutine secspec(c,c2,eqc2,gammac1,gammac2,xnuc2,ia,ja,n,i2)
 
      implicit none
      
      real*8 :: c, c2, gammac1, gammac2, xnuc2
      integer :: ia, ja, n, i2

      dimension c(*),gammac1(*),xnuc2(*),ia(*),ja(*)
      
      !local variables
      integer :: i, i1, istart, iend
      real*8 :: r1, eqc2      
      parameter (r1 = 1.0d0)
      


!c  compute secondary species concentration 

      c2 = r1/(gammac2*eqc2)
 
      istart = ia(i2)
      iend = ia(i2+1)-1
      do i = istart,iend
        i1 = ja(i)
        c2 = c2 * (gammac1(i1)*c(i1))**xnuc2(i)
      end do

      return
      end
