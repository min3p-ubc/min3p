!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 303 $
!> $Author: dsu $
!> $Date: 2015-05-04 10:58:10 -0700 (Mon, 04 May 2015) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/checkerr.F90 $
!---------------------------------------------------------------------
!********************************************************************!

      SUBROUTINE CheckErr ( ierr, label, ilog )

#ifdef PETSC
      use petsc_mpi_common, only : petsc_mpi_finalize
#endif
      use gen, only : rank
! Author: Joel VanderKwaak   May 19, 1999

      IMPLICIT NONE

      INTEGER*4 ierr,ilog
      CHARACTER(*) label

      IF (ierr == 1) THEN

        WRITE (*,10) ierr, label
!c Note: will cause write error if checkerr is called by different threads.
!c Disable this for OpenMP version. DSU

        if (rank == 0) then
          WRITE (*,10) ierr, label   
#ifndef OPENMP
          WRITE (ilog,10) ierr, label
#endif
        end if
        
#ifdef PETSC
        call petsc_mpi_finalize
#endif
        STOP

      ELSE IF (ierr > 1) THEN

        if (rank == 0) then  
          WRITE (*,20) ierr, label
#ifndef OPENMP
          WRITE (ilog,20) ierr, label
#endif
        end if

#ifdef PETSC
        call petsc_mpi_finalize
#endif
        
        STOP

      END IF

  10  FORMAT (//,'Memory allocation/deallocation error code',i6,/,a,/)
  20  FORMAT (//,'Specified array already allocated',i6,/,a,/)

      return
      end
