!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 850 $
!> $Author: dsu $
!> $Date: 2023-01-27 08:58:23 -0800 (Fri, 27 Jan 2023) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/tcorr.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine tcorr
!c ----------------
!c
!c temperature corrections for debye-huckel, equilibrium and rate 
!c constants
!c
!c written by:      Uli Mayer - June 30, 1999
!c
!c last modified:   
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c 
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           tempkel            = temperature [K]                     + -
!c
!c common:
!c bbls.f    real*8
!c           ------
!c           gascon_a(ng)       = temperature dependent solubility coefficient
!c           gascon_b(ng)       = temperature dependent solubility coefficient
!c           gascon_c(ng)       = temperature dependent solubility coefficient
!c
!c           character
!c           ---------
!c           gas_type(ng)       = specifies temperature dependence of solubility
!c                               'type_0' enthalphy (default)               
!c                               'type_1' CRC handbook
!c                               'type_2' bunsen solubility coefficients 
!c
!c chem.f:   real*8:
!c           -------
!c           dgaq(naq)          = activation energies for intra-      + -
!c                                aqueous kinetic reaction
!c           dgcm(nm)           = activation energy for               + -
!c                                dissolution-precipitation
!c                                reaction
!c           dhad(nthreads)     = Debye Huckel constant a_d depending * +
!c                                on dielectric constant and
!c                                temperature
!c           dhaq(naq)          = enthalpy changes for intra-aqueous  + -
!c                                kinetic reaction
!c           dhbd(nthreads)     = Debye Huckel constant b_d depending * +
!c                                on dielectric constant and
!c                                temperature
!c           dhcg(ng)           = enthalpy change for gases           + -
!c           dhcm(nm)           = enthalpy change of dissolution-     + -
!c                                precipitation reaction
!c           dhcmx(nmx)         = enthalpy change of dissolution-     + -
!c                                precipitation reaction
!c                                (excluded minerals)
!c           dhcr(nr)           = enthalpy change for redox reaction  + -
!c           dhcsb(nsb)         = enthalpy change for sorbed species  + -
!c           dhcsb_ion(nsb_ion) = enthalpy change for sorbed species  + -
!c                                (ion-exchange)
!c           dhcsb_surf(nsb_surf)= enthalpy change for sorbed species + -
!c                                (surface-complex)
!c           dhcx(nx)           = enthalpy change for secondary       + -
!c                                aqueous species
!c           eqaq(naq,nthreads) = equilibrium constants for           * +
!c                                intra-aqueous kinetic reactions
!c           eqaqs(naq)         = equilibrium constants for           + -
!c                                intra-aqueous kinetic reactions
!c                                at standard temperature
!c           eqg(ng,nthreads)   = equilibrium constants for gases     * +
!c           eqgs(ng)           = equilibrium constants for gases     + -
!c                                at standard temperature
!c           eqm(nm,nthreads)   = equilibrium constants for minerals  * +
!c           eqms(nm)           = equilibrium constants for minerals  + -
!c                                at standard temperature
!c           eqmx(nmx,nthreads) = equilibrium constants for excluded  * +
!c                                minerals
!c           eqmxs(nmx)         = equilibrium constants for excluded  + -
!c                                minerals at standard temperature
!c           eqsb(nsb)          = equilibrium constants for           * +
!c                                sorbed species
!c           eqsb_ion(nsb_ion,nthreads)  
!c                              = equilibrium constants for           * +
!c                                sorbed species (ion-exchange)
!c           eqsb_surf(nsb_surf,nthreads)
!c                              = equilibrium constants for           * +
!c                                sorbed species (surface-complex)
!c           eqsbs(nsb)         = equilibrium constants for           + -
!c                                sorbed species at standard
!c                                temperature
!c           eqsbs_ion(nsb_ion) = equilibrium constants for           + -
!c                                sorbed species at standard
!c                                temperature (ion-exchange)
!c           eqsbs_surf(nsb_surf)= equilibrium constants for          + -
!c                                sorbed species at standard
!c                                temperature (surface-complex)
!c           eqr(nr,nthreads)   = equilibrium constant for redox      * +
!c                                couple reaction equation
!c           eqrs(nr)           = equilibrium constant for redox      + -
!c                                for standard temperature
!c                                couple reaction equation
!c           eqx(nx,nthreads)   = equilibrium constants for           * +
!c                                secondary aqueous species
!c           eqxs(nx)           = equilibrium constants for           + -
!c                                secondary aqueous species
!c                                at standard temperature
!c           ratecaq(naq,nthreads)
!c                              = log of rate constant for intra-     * +
!c                                aqueous kinetic reactions
!c                                (units: liter -  moles - seconds)
!c           ratecaqs(naq)      = log of rate constant for intra-     + -
!c                                aqueous kinetic reactions at
!c                                stndard temperature
!c                                (units: liter -  moles - seconds)
!c           rated(ndr*nm,nthreads)     
!c                              = rate constants for dissolution      * +
!c                                reactions
!c           rateds(ndr*nm)     = rate constants for dissolution-     + -
!c                                precipitation reactions at
!c                                standard temperature
!c           rgascal            = ideal gas constant                  + -
!c                                [kcal/(deg K mole)]
!c           tconv              = temperature correction factor       + -
!c 
!c           integer*4:
!c           ---------- 
!c           iamd(nm+1)         = pointer array to dissolution-       + -
!c                                precipitation reactions
!c           naq                = number of intra-aqueous kinetic     + -
!c                                reactions
!c           ng                 = number of gases                     + -
!c           nm                 = number of minerals                  + -
!c           nmx                = number of excluded minerals         + -
!c           nr                 = number of redox couples             + -
!c           nsb                = number of sorbed species            + -
!c           nsb_ion            = number of sorbed species            + -
!c                                (ion-exchange)
!c           nsb_surf           = number of sorbed species            + -
!c                                (surface-complex)
!c           nx                 = number of aqueous complexes         + -
!c
!c local:    integer*4:
!c           ----------
!c           iaq                = counter (intra-aqueous kinetic
!c                                         reactions)
!c           ig                 = counter (gases)
!c           im                 = counter (minerals)
!c           imx                = counter (excluded minerals)
!c           ir                 = counter (redox couples)
!c           ireac              = counter (dissolution-
!c                                         precipitation reactions)
!c           isb                = counter (sorbed species)
!c           istart             = pointer
!c           istop              = pointer
!c           ix                 = counter (aqueous complexes)
!c
!c external: dhconst   = compute debye huckel constants a_d and b_d
!c           vhoff     = temperatre corrections for equilibrium and rate
!c                       constants based on integrated Van't Hoff and
!c                       Arrhenius equation
!c ----------------------------------------------------------------------
 
      subroutine tcorr(tempkel,ivol,tid)
 
      use parm
      use chem
      use bbls
      use gen, only : b_water_freezing_ratemin,                        &
                      water_freezing_ratemin, idbg,                    &
                      b_temperature_inhibition,                        &
                      temperature_inhibition,                          &
                      temperature_inhibition_coef

      implicit none
      
      real*8 :: tempkel

      integer :: ivol, tid
      
      integer :: iaq, ig, im, imx, ix, ir, ireac, isb, istart, istop 
      
      real*8, external :: vhoff, crc, bunsen, pressure_melt_k
      
      external dhconst

      real*8, parameter :: r0 = 0.0d0, r1 = 1.0d0, r100 = 100.0d0
     
      integer :: info_debug
      
     
      info_debug = 0
      
!c  debye-huckel constants

      call dhconst(dhad(tid),dhbd(tid),tempkel,tconv)

!c  aqueous complexation reactions

      do ix = 1,nx
        eqx(ix,tid) = vhoff(dhcx(ix),eqxs(ix),tempkel,tempks,rgascal)
      end do

!c  gas dissolution-exsolution reactions
!c_bubbles use appropriate temperature correction for henry's constant
      do ig = 1,ng
        if (gas_type(ig).eq.'type_0') then  
          eqg(ig,tid) = vhoff(dhcg(ig),eqgs(ig),tempkel,tempks,rgascal)
        else if (gas_type(ig).eq.'type_1') then
          eqg(ig,tid) = crc(gascon_a(ig),gascon_b(ig),gascon_c(ig),    &
                        tempkel)
        else if (gas_type(ig).eq.'type_2') then
          eqg(ig,tid) = bunsen(gascon_a(ig),gascon_b(ig),gascon_c(ig), &
                    tempkel)
        else
          eqg(ig,tid) = vhoff(dhcg(ig),eqgs(ig),tempkel,tempks,rgascal)
        end if
      end do
      

!c  dissolution-precipitation reactions

      do im = 1,nm

        eqm(im,tid) = vhoff(dhcm(im),eqms(im),tempkel,tempks,rgascal)

        istart = iamd(im)
        istop = iamd(im+1)-1

        do ireac = istart,istop
          rated(ireac,tid) = vhoff(dgcm(im),rateds(ireac),             &
                             tempkel,tempks,rgascal)
!c temperature inhibtion which is defined in database
          if (b_temperature_inhibition .and. abs(dscm(im))>r0) then         
            rated(ireac,tid) = rated(ireac,tid) /                      &
                 (r1 + exp(temperature_inhibition_coef *               &
                          (tempkel - temperature_inhibition)/          &
                           temperature_inhibition))
          end if
          
!cdsu  Assign mineral rate for frozen water but not for gasesou minerals 
          if(b_water_freezing_ratemin) then
            if (tempkel < pressure_melt_k(ivol,r0)) then
              rated(ireac,tid) = water_freezing_ratemin
              diffm(ireac,tid) = 0.0d0
            else
              !cdsu based on temperature correction of diffusion coefficient: dwilson November 24, 2015
              diffm(ireac,tid) = vhoff(dwcm(im),diffms(ireac),         &
                                       tempkel,tempks,rgascal)
            end if
          end if
          
        end do

      end do

!c  excluded mineral phases

      do imx = 1,nmx
        eqmx(imx,tid) = vhoff(dhcmx(imx),eqmxs(imx),tempkel,tempks,   &
     &                    rgascal)
      end do

!c  redox couples

      do ir = 1,nr
        eqr(ir,tid) = vhoff(dhcr(ir),eqrs(ir),tempkel,tempks,rgascal)
      end do

!c  sorption and ion-exchange reactions

      do isb = 1,nsb_ion
        eqsb_ion(isb,tid) = vhoff(dhcsb_ion(isb),eqsbs_ion(isb),      &
                            tempkel,tempks,rgascal)
      end do
      
      do isb = 1,nsb_surf
        eqsb_surf(isb,tid) = vhoff(dhcsb_surf(isb),eqsbs_surf(isb),   &
                             tempkel,tempks,rgascal)
      end do

!c  intra-aqueous kinetic reactions

      do iaq = 1,naq
        eqaq(iaq,tid) = vhoff(dhaq(iaq),eqaqs(iaq),tempkel,tempks,    &
     &                        rgascal)                                     
        ratecaq(iaq,tid) = vhoff(dgaq(iaq),ratecaqs(iaq),             &
     &                           tempkel,tempks, rgascal)

!cdsu  Assign mineral rate for intra-aqueous kinetic reactions
        if(b_water_freezing_ratemin) then
          if (tempkel < pressure_melt_k(ivol,r0)) then
            ratecaq(iaq,tid) = water_freezing_ratemin
          end if
        end if

      end do

      return
      end
