!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 221 $
!> $Author: dsu $
!> $Date: 2014-08-05 14:29:49 -0700 (Tue, 05 Aug 2014) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/phpe.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine phpe
!c ---------------
!c
!c compute ph, pe and Eh
!c
!c written by:      Uli Mayer - January 31, 98
!c
!c last modified:   -
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           c                  = free species concentrations         + -
!c           eh                 = Eh                                  * +
!c           gammac             = activity coefficients of            + -
!c                                free species
!c           pe                 = pe                                  * +
!c           ph                 = pH                                  * +
!c           tempkel            = temperature [K]                     + -
!c
!c common:   
!c chem.f:   real*8:
!c           -------
!c           ehfac              = factor for calculating Eh from pe   + -
!c
!c           integer*4:
!c           ----------
!c           nc                 = number of components                + -
!c
!c           logical:
!c           --------
!c           ph_output          = .true.  -> output of pH             + -
!c           pe_output          = .true.  -> output of pe and Eh      + -
!c
!c           character:
!c           ----------
!c           namec(nc)          = component names                     + -
!c           redox_master       = 'e-1'                               + -
!c                                'o2(aq)'
!c                                'h2(aq)'
!c           
!c local:    integer*4:
!c           ----------
!c           ic                 = counter (components)
!c
!c external: -
!c ----------------------------------------------------------------------
 
      subroutine phpe(c,gammac,ph,pe,eh,tempkel)
 
      use parm
      use chem

      implicit none
      
      real*8 :: c, gammac, ph, pe, eh, tempkel
      
      integer :: ic

      dimension c(*), gammac(*)

!c  initialize the value, for some compiler, if ph or pe is never calculated in the following
!c  steps, it will return NaN. DSU, 2013-10-17
      ph = 0.0d0
      pe = 0.0d0
      eh = 0.0d0

!c  compute pH

      if (ph_output) then
        !ph = 0.0d0
        do ic=1,nc-1
          if (namec(ic).eq.'h+1') then
            ph = -dlog10(gammac(ic)*c(ic))
            exit
          end if
        end do
      end if

!c  compute pe and Eh

      if (pe_output) then
        !pe = 0.0d0
        do ic=1,nc-1
          if (namec(ic).eq.'e-1') then           !from e-1
            pe = -dlog10(c(ic))
            eh = ehfac * tempkel * pe
            exit
          end if
        end do
        if (ph_output) then
          do ic=1,nc-1
            if (redox_master.eq.'o2(aq)'.and.                         &
                namec(ic).eq.'o2(aq)') then                            
              pe = 21.5045d0                                          &
                 - dlog10(gammac(nc)**0.5d0)                          &
                 + dlog10((gammac(ic)*c(ic))**0.25d0)                 &
                 - ph                                                  
              eh = ehfac * tempkel * pe                                
            elseif (redox_master.eq.'h2(aq)'.and.                     &
                namec(ic).eq.'h2(aq)') then                            
              pe = -1.562d0                                           &
                 - dlog10((gammac(ic)*c(ic))**0.50d0)                 &
                 - ph
              eh = ehfac * tempkel * pe
            end if
             
          end do
        end if
      end if

      return
      end

