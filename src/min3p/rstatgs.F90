!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 869 $
!> $Author: dsu $
!> $Date: 2023-08-18 09:44:21 -0700 (Fri, 18 Aug 2023) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/rstatgs.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine rstatgs
!c ------------------
!c
!c run specific statistics
!c
!c written by:      Uli Mayer - May 8, 96
!c
!c last modified:   Tom Henderson - June 24, 2003
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   integer*4:
!c           ----------
!c           idev                = unit number for output device      + -
!c
!c common:     
!c gen.f:    real*8:
!c           -------
!c           cpuint             = cputime - intermediate [seconds]    + *
!c           csec               = cputime [seconds]                   + +
!c
!c           integer*4:
!c           ----------
!c           ittot_vs           = total number of iterations          + -
!c                                (variably saturated flow)
!c           itseep_tot         = total number of seepage face        + -
!c                                iterations
!c           ittot_rt           = total number of iterations          + -
!c                                (reactive transport)
!c           itsolvtot_rt       = total number of solver              + -
!c                                iterations
!c                                (reactive transport)
!c           itsolvtot_vs       = total number of solver              + -
!c                                iterations
!c                                (variably saturated flow)
!c           mtime              = time step counter                   + -
!c           mtime_f            = number of failed time steps         + -
!c
!c           logical:
!c           --------
!c           varsat_flow        = .true.  -> perform flow simulation  + -
!c           reactive_transport = .true.  -> perform reactive         + -
!c                                           transport simulation
!c           transient_flow     = .true.  -> .not.steady_flow,        + -
!c                                        -> transient flow
!c           seepage_face       = .true.  -> seepage face boundary    + -
!c                                           specified
!c
!c dens.f:   integer*4:
!c           ----------
!c           msia               = total number of sequential          * +           
!c                                iterations 
!c
!c local:    real*8:
!c           -------
!c           cpuint_old         = cputime - intermediate [seconds]
!c           cmin               = cputime [minutes]
!c           chrs               = cputime [hours]
!c           tiny               = small increment
!c           r60                = constant
!c           r3600              = constant
!c           r86400             = constant
!c
!c external: cputime  = determine cputime
!c ----------------------------------------------------------------------
 
      subroutine rstatgs(idev)
 
      use parm
      use gen
      use dens

      implicit none
      
      integer :: idev
      
      integer :: i
      
      real*8 :: cpuint_old, cmin, chrs

      real*8, external :: cputime

      real*8, parameter :: r60 = 6.0d1, r3600 = 3.6d3, r86400 = 8.64d4,&
                           tiny = 1.d-10
 
!c  statistics - variably saturated flow

      if (varsat_flow) then
        write(idev,'(/a)') 'statistics - variably saturated flow ...' 
        write(idev,'(72a/)')('-',i=1,72)
        if (seepage_face) then
          write(idev,'(a,i10)')                                       &
            'total number of seepage face iterations = ',itseep_tot   
        end if                                                         
        write(idev,'(a,i10)')                                         &
           'total number of Newton iterations       = ',ittot_vs       
        write(idev,'(a,i10)')                                         &
           'total number of solver iterations       = ',itsolvtot_vs
      end if

!c statistics - decoupled heat transport
      if (heat_transport .and. decoupled_type_vs_heat > 1) then
         write(idev,'(/a)') 'statistics - heat transport ...' 
         write(idev,'(72a/)')('-',i=1,72)
         write(idev,'(a,i10)')                                         &
            'total number of Newton iterations       = ',ittot_heat    
         write(idev,'(a,i10)')                                         &
            'total number of solver iterations       = ',itsolvtot_heat
      end if

!c  statistics - reactive transport

      if (reactive_transport) then
        write(idev,'(/a)') 'statistics - reactive transport ...' 
        write(idev,'(72a/)')('-',i=1,72)
        write(idev,'(a,i10)')                                          &
           'total number of Newton iterations       = ',ittot_rt    
        write(idev,'(a,i10)')                                          &
           'total number of solver iterations       = ',itsolvtot_rt
      end if

!c  general run specific statistics

      write(idev,'(/a)') 'general run specific statistics ...' 
      write(idev,'(72a/)')('-',i=1,72)
      if (reactive_transport.or.transient_flow) then
        write(idev,'(a,i10)')                                         &
     &        'number of failed time steps             = ',mtime_f     
        write(idev,'(a,i10)')                                         &
     &        'total number of time steps              = ',mtime       
        write(idev,'(a,i10)')                                         &
     &        'total number of coupling iterations     = ',msia
      end if

!c  determine total cputime and convert to reasonable units
 
      cpuint_old = cpuint
      cpuint = cputime()
      if (cpuint.lt.cpuint_old) then
        csec = csec + cpuint - cpuint_old + r86400
      else
        csec = csec + cpuint - cpuint_old
      end if
  
!c  < 1 minute -> report in seconds

      if (csec.lt.r60) then 
         write(idev,'(a,f5.2,a)') 'cputime  = ',csec,' sec'

!c  < 1 hour -> report in minutes and seconds

      elseif (csec.ge.r60.and.csec.lt.r3600) then
        cmin = float(int(csec/r60))
        csec = float(int(csec - cmin*r60))
        write(idev,'(a,2(i0,a))')                                     &
        'cputime  = ',int(cmin+tiny),' min ',int(csec+tiny),' sec'

!c  > 1 hour -> report in hours, minutes and seconds

      elseif (csec.ge.r3600) then
        chrs = float(int(csec/r3600))
        cmin = float(int(csec/r60 - chrs*r60))
        csec = float(int(csec - cmin*r60 - chrs*r3600))
        write(idev,'(a,3(i0,a))')                                     &
        'cputime  = ',int(chrs+tiny),' hrs ',int(cmin+tiny),' min ',  &
                      int(csec+tiny),' sec'
      end if

      return
      end
