!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 268 $
!> $Author: dsu $
!> $Date: 2015-01-09 17:00:41 -0800 (Fri, 09 Jan 2015) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/evap.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!cprovi----------------------------------------------------------------------
!cprovi subroutine evaporation
!cprovi
!cprovi Compute evaporation 
!cprovi----------------------------------------------------------------------
real*8 function evap (densv_ivol,por_ivol,saw_ivol,rh_ivol,area_ivol)
 
use parm
use gen
use phys
use dens
use chem
 
implicit none

real*8 :: densv_ivol,por_ivol,saw_ivol,rh_ivol,area_ivol

real*8 :: rs_ivol, theta

character(len=100) :: label

real*8, parameter  :: r0 = 0.0d0, & 
                      r1 = 1.0d0, &
                      r10 = 10.0d0, &
                      r03563 = 0.3563d0, &
                      r3563 = 35.63d0, &
                      r86400 = 86400.0d0, &
                      rcte1 = 3.5d0, &
                      rcte2 = 2.30d0, &
                      rcte3 = 33.5d0, &
                      theta_min = 0.15d0   

rs_ivol = r0

!cprovi------------------------------------------------------------------
!cprovi Compute the soil surface reistance to vapor flow
!cprovi See Bitelli et al. (2008)
!cprovi Coupling oh heat, water vapor, and liquid water fluxes to
!cpeovi compute evaporation in bare soils  
!cprovi Journal of Hydrology 362, 191-205
!cprovi------------------------------------------------------------------
select case(rs_model_atm)

case ('model 1')
 rs_ivol = (rcte1 * (r1/saw_ivol)**rcte2 + rcte3)
case ('model 2')
 rs_ivol = (-805.0d0 + 4140.0d0 * por_ivol * (r1-saw_ivol))
case ('model 3')
 theta = por_ivol * saw_ivol 
 rs_ivol = (r10**(r03563*(theta_min-theta)))
case ('model 4')
   !cprovi----------------------------------------------------------------------------------
   !cprovi Soil resistance model taken from 
   !cprovi Simunek, J.; Sejna, M.; Saito, H.; Sakai, M. & Van Genuchten, M. 
   !cprovi The HYDRUS-1D software package for simulating the one dimensional 
   !cprovi movement of water, heat, and multiple solutes in variably-saturated media. 
   !cprovi Version 4.08. HYDRUS Softw. Ser. 3. 
   !cprovi Department of Environmenatal Science Univsersity of California, Riverside., 2009
   !cprovi----------------------------------------------------------------------------------
   theta = por_ivol * saw_ivol 
   if (theta<=theta_min) then
     rs_ivol = r10*dexp(r3563*(theta_min-theta))
   else
     rs_ivol = r10
   end if
case default  
 rs_ivol = r0   
end select 
!cprovi------------------------------------------------------------------
!cprovi Change units of resistance s/m => day/m 
!cprovi------------------------------------------------------------------
rs_ivol = rs_ivol / r86400 
!cprovi------------------------------------------------------------------
!cprovi Compute evaporation 
!cprovi------------------------------------------------------------------
evap = facevap_atm*area_ivol*(densv_atm-densv_ivol) / (rs_ivol + rh_ivol)
!cprovi------------------------------------------------------------------
!cprovi------------------------------------------------------------------
!cprovi------------------------------------------------------------------
return
end function 