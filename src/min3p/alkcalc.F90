!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 850 $
!> $Author: dsu $
!> $Date: 2023-01-27 08:58:23 -0800 (Fri, 27 Jan 2023) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/alkcalc.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine alkcalc
!c ------------------
!c
!c compute alkalinity
!c
!c written by:      Uli Mayer - August 18, 99
!c
!c last modified:   -
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           alk_carb           = carbonate alkalinity [eq/L]         * +
!c           alk_noncarb        = noncarbonate alkalinity [eq/L]      * +
!c           alk_tot            = total alkalinity [eq/L]             * +
!c           alk_carb_mg        = carbonate alkalinity [mg/L CaCO3]   * +
!c           alk_noncarb_mg     = non-carbonate alkalinity            * +
!c                                [mg/L CaCO3]
!c           alk_tot_mg         = total alkalinity [mg/L CaCO3]       * +
!c           alkfacc(nc)        = alkalinity factors for components   + -
!c                                as species in solution
!c           alkfacx(nx)        = alkalinity factors for aqueous      + -
!c                                complexes
!c           c(nc)              = concentrations of components as     + -
!c                                species in solution
!c           cx(nx)             = aqueous complex concentrations      + -
!c
!c           integer*4:
!c           ----------
!c           iax(nx+1)          = row pointer array to                + -
!c                                stoichiometric coefficients of
!c                                components in aqueous complexes
!c           jax(nx*nc)         = column pointer array to             + -
!c                                stoichiometric coefficients of
!c                                components in aqueous complexes
!c           nc                 = number of components                + -
!c           nx                 = number of aqueous complexes         + -
!c
!c           character:
!c           ----------
!c           namec(nc)          = component names                     + -
!c           namex(nc)          = names of aqueous complexes          + -
!c           
!c local:    real*8:
!c           -------
!c           r0                 = constant
!c           rconv              = conversion factor 
!c                                [eq/L] -> [mg/L CaCO3]
!c   
!c           integer*4:
!c           ----------
!c           i2                 = counter
!c           ic                 = counter (components)
!c           istart             = pointer
!c           istop              = pointer
!c           ix                 = counter (aqueous complexes)
!c
!c           logical:
!c           --------
!c           carb_alkalinity    = .true.  -> add contribution to
!c                                           carbonate alkalinity
!c           
!c external: -
!c ----------------------------------------------------------------------
 
      subroutine alkcalc(alk_carb,alk_noncarb,alk_tot, &
                        alk_carb_mg,alk_noncarb_mg,alk_tot_mg, &
                        alkfacc,alkfacx,c,cx,iax,jax,nc,nx, &
                        namec,namex)
 
      implicit none
      
      real*8 :: alk_carb,alk_noncarb,alk_tot,alk_carb_mg,              &
                alk_noncarb_mg,alk_tot_mg      
      real*8 :: alkfacc(*), alkfacx(*), c(*), cx(*)

      integer :: nc, nx
      integer :: iax(*), jax(*)
      
      character*72 :: namec(*), namex(*)
      logical carb_alkalinity
               
      
      !local variables
      real*8 :: r0, rconv
      integer :: ic, ix, i2, istart, istop
      parameter (r0 = 0.0d0, rconv = 5.00447d+4)
 
      alk_noncarb = r0
      alk_carb=r0
      alk_carb_mg=r0
      alk_noncarb_mg=r0
      alk_tot_mg=r0
      
      

!c  compute alkalinity in eq/L
!c  distinguish between carbonate and non-carbonate alkalinity

!c  components as species in solution

      do ic = 1,nc
        if (namec(ic).eq.'co3-2') then
          alk_carb = alkfacc(ic) * c(ic)
        else
          alk_noncarb = alk_noncarb + alkfacc(ic) * c(ic)        
        end if
      end do

!c  aqueous complexes

      do ix = 1,nx

        istart = iax(ix)
        istop = iax(ix+1)-1
        carb_alkalinity = .false.

        do i2 = istart,istop
          ic = jax(i2)
          if (namec(ic).eq.'co3-2') then
            carb_alkalinity = .true.
          end if
        end do

        if (carb_alkalinity) then
          alk_carb = alk_carb + alkfacx(ix) * cx(ix)
        else
          alk_noncarb = alk_noncarb + alkfacx(ix) * cx(ix)
        end if

      end do

!c  compute total alkalinity

      alk_tot = alk_carb + alk_noncarb

!c  convert alkalinities in mg/L CaCO3

      alk_tot_mg = alk_tot*rconv
      alk_carb_mg = alk_carb*rconv
      alk_noncarb_mg = alk_noncarb*rconv

      return
      end

