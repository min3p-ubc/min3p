!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 726 $
!> $Author: dsu $
!> $Date: 2019-08-07 11:30:33 -0700 (Wed, 07 Aug 2019) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/gas_advection/relpfsat_g.F90 $
!---------------------------------------------------------------------
!********************************************************************!
!c ----------------------------------------------------------------------
!c real*8 function relpfsat_g
!c --------------------------
!c
!c compute relative permeability of gas phase from saturation
!c  
!c compute the relative permeability using linear interpolation
!c at high gas saturations and a value of zero at very low saturations, 
!c otherwise use a van Genuchten-type relationship for the gas phase
!c according to Parker (WRR,23(4),1987)
!c
!c this subroutine is the gas phase version of relpfsat 
!c
!c relpfsat had the following history: -------------------------
!c
!c taken from Joel VanderKwaak's Water Transport Simulator (WTS)
!c Version 1.0, March, 1996 
!c 
!c eps_conv is hardwired - should pass value through
!c
!c written by:      Kerry MacQuarrie - Nov. 1995
!c
!c last modified:   Uli Mayer - November 25, 96
!c                  Uli Mayer - February 13, 01
!c                  changed value for eps_conv:
!c                  Note setting k_rw to 0 seems not a wise 
!c                  thing to do
!c
!c                  Danyang Su - March 26, 2014
!c
!c -------------------------------------------------------------
!c
!c gas phase version: Sergi Molins - January 20, 2003
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           swc                = water saturation                    + -
!c           swr                = residual water saturation           + -
!c           expn               = krw - p equation exponent           + -
!c           gamma              = power index                         + -
!c           relpfsat_g         = relative permeability               * +
!c
!c common:   -  
!c
!c local:    real*8:
!c           -------
!c           se                 = effective saturation
!c           term1              = intermediate value
!c           v_gamma            = intermediate value
!c           sat_1              = intermediate value
!c           rkw_1              = intermediate value
!c           dk_ds              = intermediate value
!c           r1                 = constant
!c           r2                 = constant
!c           r0                 = constant
!c           eps_conv           = constant
!c           aconstant          = constant
!c
!c external: -
!c ----------------------------------------------------------------------
 
      real*8 function relpfsat_g(swc,swr,expn,gamma)

      implicit none
      
      real*8 :: swc,swr,expn,gamma
      
      real*8 :: r0, r1, eps_conv, aconstant, r2

      parameter (r0 = 0.0d0, r1 = 1.0d0, eps_conv = 1.0d-6,           &
     &           aconstant = r1 - eps_conv, r2 = 2.0d0)
      
      !local variables
      real*8 :: se, v_gamma, sat_1, term1, rkw_1, dk_ds

!c  compute effective saturation

      se = (swc - swr)/(r1 - swr)

!c  compute some constants

      v_gamma = r1/gamma

!c  close to (liquid phase) saturation -> set to zero

      if (se.gt.aconstant) then

         relpfsat_g = r0
              
!c  close to (liquid phase) residual saturation -> use linear interpolation
!c  Unlike aqueous phase, this is not necessary for the gas phase. 
!      elseif (se.lt.eps_conv) then
!          
!#ifdef DEBUG
!        write(*,*) "relpfsat_g -- 2"
!#endif
!
!         !sat_1 = aconstant    !Bug, use eps_conv instead.
!         sat_1 = eps_conv
!         term1 = (r1-sat_1**(v_gamma))**(r2*gamma)
!         rkw_1 = dsqrt(r1-sat_1)*term1
!
!!c  note that the k_rw at sat=1.0 is 1.0
!
!         dk_ds  = (r1-rkw_1)/(r1-sat_1)
!         relpfsat_g = dk_ds*(se-sat_1)+rkw_1
!         
!#ifdef DEBUG
!         write(*,'(3(a,1x,1pe15.6e3,1x))') "rkw_1",rkw_1,"dk_ds",dk_ds,"relpfsat_g",relpfsat_g
!#endif

!c  intermediate saturations -> use van Genuchten directly

      else

         term1 = (r1-se**(v_gamma))**(r2*gamma)
!cff      relpfsat = se**expn*(r1-term1)*(r1-term1)      !for l = variable
         relpfsat_g = dsqrt(r1-se)*term1                 !for l = 0.5d0

      end if

      return
      end

