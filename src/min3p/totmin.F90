!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 221 $
!> $Author: dsu $
!> $Date: 2014-08-05 14:29:49 -0700 (Tue, 05 Aug 2014) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/totmin.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c subroutine totmin
!c -----------------
!c
!c compute total source/sink term towards total aqueous component 
!c concentrations due to mineral dissolution-precipitation reactions
!c or derivative thereof
!c
!c written by:      Uli Mayer - February 11, 96
!c
!c last modified:   Uli Mayer - February 4, 98
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           -------
!c           ratem(nm)          = absolute dissolution-precipitation  + -
!c                                rates of minerals 
!c                                [moles/(l bulk*day)]
!c           totm(nc-1)         = total source/sink term towards      * +
!c                                aqueous component concentrations
!c                                due to mineral dissolution-
!c                                precipitation reactions
!c                                [moles/(l bulk*day)]
!c common:
!c chem.f:   real*8:
!c           -------
!c           xnum(nm*nc)        = stoichiometric coefficients of      + -
!c                                components in mineral
!c
!c           integer*4:
!c           ----------
!c           iam(nm+1)          = row pointer array to                + -
!c                                stoichiometric coefficients of
!c                                components in mineral
!c           jam(nm*nc)         = column pointer array to             + -
!c                                stoichiometric coefficients of
!c                                components in mineral
!c           nc                 = number of components including h2o  + -
!c           nm                 = number of minerals                  + -
!c
!c
!c local:    integer*4:
!c           ----------
!c           i                  = counter (stoichiometric
!c                                coefficients)
!c           ic                 = counter (components) 
!c           im                 = counter (minerals)
!c           istart             = pointer (stoichiometric 
!c                                coefficients)
!c           iend               = pointer (stoichiometric
!c                                coefficients)
!c
!c external: zero_r8    = zero real*8 array
!c ----------------------------------------------------------------------
  
      subroutine totmin(ratem,totm)
 
      use parm
      use chem

      implicit none
      
      integer :: i, ic, im, istart, iend

      external zero_r8
      
      real*8 :: ratem, totm
 
      dimension ratem(*),totm(*)

      call zero_r8(totm,nc-1,1,1)
 
      do im = 1,nm

        istart = iam(im)
        iend = iam(im+1)-1
        do i = istart,iend
          ic = jam(i)

!c  skip h2o, since not a primary unknown
 
          if (namec(ic).ne.'h2o') then
            totm(ic) = totm(ic)+xnum(i)*ratem(im)
          end if
        end do

      end do

      return
      end
