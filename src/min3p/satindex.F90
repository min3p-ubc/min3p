!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 221 $
!> $Author: dsu $
!> $Date: 2014-08-05 14:29:49 -0700 (Tue, 05 Aug 2014) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/satindex.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c -----------------------------------------------------------------------
!c subroutine satindex
!c -------------------
!c
!c compute saturation index for species isp
!c
!c written by:      Uli Mayer - February 12, 96
!c
!c last modified:   Uli Mayer - September 8, 97
!c                  passed all variables
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c
!c passed:   real*8:
!c           -------
!c           c(nc)              = concentrations of free species      + -
!c                                - new time level [moles/l water]
!c           eqsp               = equilibrium constants of species    + -
!c           gammac(*)          = activity coefficients of components + -
!c                                as species in solution
!c           satindex           = saturation index for species isp    * +
!c           xnusp(*)           = stoichiometric coefficients of      + -
!c                                components in specie
!c
!c           integer*4:
!c           ----------
!c           ia(*)              = row pointer array to                + -
!c                                stoichiometric coefficients of
!c                                free species in mineral
!c           ja(*)              = column pointer array to             + -
!c                                stoichiometric coefficients of
!c                                free species in mineral
!c           isp                = pointer to current species          + -
!c
!c local:    real*8:
!c           -------
!c           prodiap            = ion activity product
!c           r1                 = constant
!c
!c           integer*4:
!c           ----------
!c           i                  = counter (stoichiometric
!c                                coefficient in dense format)
!c           ic                 = counter (components) 
!c           istart             = pointer (stoichiometric 
!c                                coefficient of species isp)
!c           iend               = pointer (stoichiometric
!c                                coefficient of species isp+1)
!c
!c external: -
!c ----------------------------------------------------------------------
  
      real*8 function satindex (c,eqsp,gammac,xnusp,ia,ja,isp)
 
      implicit none
      
      real*8 :: c, eqsp, gammac, xnusp
      integer :: ia, ja, isp
 
      dimension c(*),gammac(*),xnusp(*),ia(*),ja(*)
      
      !local variables
      real*8 :: r1, prodiap
      integer :: i, ic, istart, iend

      parameter (r1 = 1.0d0)
 
      prodiap = r1
      istart = ia(isp)
      iend = ia(isp+1)-1
      do i = istart,iend
        ic = ja(i)
        prodiap = prodiap*(gammac(ic)*c(ic))**xnusp(i)
      end do
      satindex = prodiap/eqsp
 
      return
      end
