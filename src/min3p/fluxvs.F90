!*****Revision Informations Automatically Generated by VisualSVN*****!
!---------------------------------------------------------------------
!> $ID:$
!> $Revision: 268 $
!> $Author: dsu $
!> $Date: 2015-01-09 17:00:41 -0800 (Fri, 09 Jan 2015) $
!> $URL: https://min3psvn.ubc.ca/svn/min3p_thcm/branches/dsu_new_add_2024Jan/src/min3p/fluxvs.F90 $
!---------------------------------------------------------------------
!********************************************************************!

!c ----------------------------------------------------------------------
!c real*8 function fluxvs
!c ----------------------
!c
!c compute water flux for variably saturated conditions
!c
!c written by:      Uli Mayer - May 29, 96
!c
!c last modified:
!c
!c definition of variables:
!c
!c I --> on input   * arbitrary  - initialized  + entries expected
!c O --> on output  * arbitrary  - unaltered    + altered
!c                                                                    I O
!c passed:   real*8:
!c           ------- 
!c           hhead_i            = hydraulic head in control volume i  + -
!c                                currently considered
!c           hhead_j            = hydraulic head in control volume j  + -
!c           relperm_i          = relative permeability in control    + -
!c                                volume i
!c           relperm_j          = relative permeability in control    + -
!c                                volume j
!c           cinfvs             = influence coefficient               + -
!c           fluxvs             = water flux at interface             * +
!c 
!c           logical:
!c           --------
!c           upstream           = .true.  -> upstream weighting of    + -
!c                                           relative permeabilities 
!c           character:
!c           ----------
!c           iups               = upstream pointer                    + -
!c
!c common:   -
!c           
!c local:    real*8:
!c           -------
!c           rhalf              = constant
!c
!c external: -
!c ----------------------------------------------------------------------
 
      real*8 function fluxvs(upstream,hhead_i,hhead_j,relperm_i,  &
                            relperm_j,iups,cinfvs)
 
      implicit none
      
      real*8 :: hhead_i, hhead_j, relperm_i, relperm_j, cinfvs

      logical upstream
      character*1 iups
      
      !local variables
      real*8 :: rhalf, relperm

      parameter (rhalf = 0.5d0)

      relperm = 0.0d0

!c  upstream or centered weighting for relative permeabilities

      if (upstream) then                         !upstream weighting
        if (iups.eq.'i') then
          relperm = relperm_i
        elseif (iups.eq.'j') then
          relperm = relperm_j
        end if
      else                                       !centered weighting
        relperm = (relperm_i+relperm_j)*rhalf
      end if

!c  compute interfacial flux

      fluxvs = relperm*cinfvs*(hhead_j-hhead_i)
 
      return
      end
